# ğŸŒŸ 5.2 ë¦¬ì•¡íŠ¸ í›…ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ìƒíƒœ ê´€ë¦¬

## ğŸ“Œ 5.2.1 ê°€ì¥ ê¸°ë³¸ì ì¸ ë°©ë²•: useStateì™€ useReducer

```js
function useCounter(initCount: number = 0) {
  const [counter, setCounter] = useState(initCount);

  function inc() {
    setCounter((prev) => prev + 1);
  }

  return { counter, inc };
}
```

- useStateëŠ” useReducerë¡œ êµ¬í˜„ ê°€ëŠ¥, ë°˜ëŒ€ë„ ê°€ëŠ¥
- ë‘ ì»´í¬ë„ŒíŠ¸ê°€ ë™ì¼í•œ ìƒíƒœë¥¼ ë°”ë¼ë³´ê²Œ í•˜ê¸° ìœ„í•´ì„œëŠ”, ìƒíƒœë¥¼ ì»´í¬ë„ŒíŠ¸ ë°–ìœ¼ë¡œ í•œ ë‹¨ê³„ ëŒì–´ì˜¬ë¦¬ëŠ” ê²ƒ -> propsë¡œ ì „ë‹¬í•´ì•¼í•˜ëŠ” ë²ˆê±°ë¡œì›€ì´ ìˆìŒ

## ğŸ“Œ 5.2.2 ì§€ì—­ ìƒíƒœì˜ í•œê³„ë¥¼ ë²—ì–´ë‚˜ë³´ì: useStateì˜ ìƒíƒœë¥¼ ë°”ê¹¥ìœ¼ë¡œ ë¶„ë¦¬í•˜ê¸°

í•¨ìˆ˜ ì™¸ë¶€ì—ì„œ ìƒíƒœë¥¼ ì°¸ì¡°í•˜ê³  ì´ë¥¼ í†µí•´ ë Œë”ë§ê¹Œì§€ ìì—°ìŠ¤ëŸ½ê²Œ ì¼ì–´ë‚˜ë ¤ë©´

1. ê¼­ windowë‚˜ globalì— ìˆì–´ì•¼ í•  í•„ìš”ëŠ” ì—†ì§€ë§Œ ì»´í¬ë„ŒíŠ¸ ì™¸ë¶€ ì–´ë”˜ê°€ì— ìƒíƒœë¥¼ ë‘ê³  ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ê°€ ê°™ì´ ì“¸ ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.
2. ì´ ì™¸ë¶€ì— ìˆëŠ” ìƒíƒœë¥¼ ì‚¬ìš©í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ëŠ” ìƒíƒœì˜ ë³€í™”ë¥¼ ì•Œì•„ì±Œ ìˆ˜ ìˆì–´ì•¼ í•˜ê³  ìƒíƒœê°€ ë³€í™”ë  ë•Œë§ˆë‹¤ ë¦¬ë Œë”ë§ì´ ì¼ì–´ë‚˜ì„œ ì»´í¬ë„ŒíŠ¸ë¥¼ ìµœì‹  ìƒíƒœê°’ ê¸°ì¤€ìœ¼ë¡œ ë Œë”ë§í•´ëŒœ í•œë‹¤. ì´ ìƒíƒœ ê°ì§€ëŠ” ìƒíƒœë¥¼ ë³€ê²½ì‹œí‚¤ëŠ” ì»´í¬ë„ŒíŠ¸ë¿ë§Œ ì•„ë‹ˆë¼ ì´ ìƒíƒœë¥¼ ì°¸ì¡°í•˜ëŠ” ëª¨ë“  ì»´í¬ë„ŒíŠ¸ì—ì„œ ë™ì¼í•˜ê²Œ ì‘ë™í•´ì•¼ í•œë‹¤.
3. ìƒíƒœê°€ ì›ì‹œê°’ì´ ì•„ë‹Œ ê°ì²´ì¸ ê²½ìš°ì— ê·¸ ê°í…Œì— ë‚´ê°€ ê°ì§€í•˜ì§€ ì•ŠëŠ” ê°’ì´ ë³€í•œë‹¤ í•˜ë”ë¼ë„ ë¦¬ë Œë”ë§ì´ ë°œìƒí•´ì„œëŠ” ì•ˆëœë‹¤.

```js
export const createStore = <State extends unknown>(
  initialState: Initializer<State>,
): Store<State> => {
  // useStateì™€ ë§ˆì°¬ê°€ì§€ë¡œ ì´ˆê¹ƒê°’ì„ ê²Œìœ¼ë¥¸ ì´ˆê¸°í™”ë¥¼ ìœ„í•œ í•¨ìˆ˜ ë˜í•œ
  // ê·¸ëƒ¥ ê°’ì„ ë°›ì„ ìˆ˜ ìˆë„ë¡ í•œë‹¤.
  // stateì˜ ê°’ì€ ìŠ¤í† ì–´ ë‚´ë¶€ì—ì„œ ë³´ê´€í•´ì•¼ í•˜ë¯€ë¡œ ë³€ìˆ˜ë¡œ ì„ ì–¸í•œë‹¤.
  let state = typeof initialState !== 'function' ? initialState : initialState()

  // callbacksëŠ” ìë£Œí˜•ê³¼ ê´€ê³„ì—†ì´ ìœ ì¼í•œ ê°’ì„ ì €ì¥í•  ìˆ˜ ìˆëŠ” Setì„ ì‚¬ìš©í•œë‹¤.
  const callbacks = new Set<() => void>()

  const get = () => state
  const set = (nextState: State | ((prev: State) => State)) => {
    // ì¸ìˆ˜ê°€ í•¨ìˆ˜ë¼ë©´ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•´ ìƒˆë¡œìš´ ê°’ì„ ë°›ê³ , ì•„ë‹ˆë¼ë©´ ìƒˆë¡œìš´ ê°’ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•œë‹¤.
    state = typeof nextState === 'funciton' ? (nextState as (prev: State) => State)(state) : nextState

    // ê°’ì˜ ì„¤ì •ì´ ë°œìƒí•˜ë©´ ì½œë°± ëª©ë¡ì„ ìˆœíšŒí•˜ë©´ì„œ ëª¨ë“  ì½œë°±ì„ ì‹¤í–‰í•œë‹¤.
    callbacks.forEach((callback) => callback())

    return state
  }

  const subscribe = (callback: () => void) => {
    // ë°›ì€ í•¨ìˆ˜ë¥¼ ì½œë°± ëª©ë¡ì— ì¶”ê°€í•œë‹¤.
    callbacks.add(callback)
    // í´ë¦°ì—… ì‹¤í–‰ ì‹œ ì´ë¥¼ ì‚­ì œgoì„œ ë°˜ë³µì ìœ¼ë¡œ ì¶”ê°€ë˜ëŠ” ê²ƒì„ ë§‰ëŠ”ë‹¤.
   return () => {
    callbacks.delete(callback)
   }
  }

  return { get, set, subscribe }
}
```

```js
export const useStore = <State extends unknown>(store: Store<state>) => {
  // ì»´í¬ë„ŒíŠ¸ ë Œë”ë§ ìœ ë„
  const [state, setState] = useState<State>(() => store.get())

  // useEffectëŠ” storeì˜ í˜„ì¬ ê°’ì„ ê°€ì ¸ì™€ setStateë¥¼ ìˆ˜í–‰í•˜ëŠ” í•¨ìˆ˜ë¥¼ storeì˜ subscribeë¡œ ë“±ë¡í•´ ë‘ì—ˆë‹¤. createStore ë‚´ë¶€ì—ì„œ ê°’ì´ ë³€ê²½ë  ë•Œë§ˆë‹¤ subscribeì— ë“±ë¡ëœ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ë¯€ë¡œ useStore ë‚´ë¶€ì—ì„œëŠ” storeì˜ ê°’ì´ ë³€ê²½ë  ë•Œë§ˆë‹¤ stateì˜ ê°’ì´ ë³€ê²½ë˜ëŠ” ê²ƒì„ ë³´ì¥
  useEffect(() => {
    const unscribe = store.subscribe(() => {
      setState(store.get())
    })
    // useEffectì˜ ì‘ë™ì´ ëë‚œ ì´í›„ì—ëŠ” callbackì—ì„œ í•´ë‹¹ í•¨ìˆ˜ë¥¼ ì œê±°í•´ callbackì´ ê³„ì† ìŒ“ì´ëŠ” í˜„ìƒ ë°©ì§€
    return unsubscribe
  }, [store])

  return [state, store.set] as const
}
```

- useSubscriptionì„ ì‚¬ìš©í•˜ë©´ ìœ„ì™€ ê°™ì€ ë°©ì‹ìœ¼ë¡œ ì™¸ë¶€ì— ìˆëŠ” ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì„œ ì‚¬ìš©í•˜ê³  ë¦¬ë Œë”ë§ê¹Œì§€ ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰
  - React 18: useSyncExternalStore
    https://ko.react.dev/reference/react/useSyncExternalStore

## ğŸ“Œ 5.2.3 useStateì™€ Contextë¥¼ ë™ì‹œì— ì‚¬ìš©í•´ë³´ê¸°

- storeì„ ì—¬ëŸ¬ê°œ ì‚¬ìš©í•˜ê³  ì‹¶ì„ ë•Œ, Contextì™€ í•¨ê»˜ ì“°ë©´ ëœë‹¤.

```js
// Contextë¥¼ ìƒì„±í•˜ë©´ ìë™ìœ¼ë¡œ ìŠ¤í† ì–´ë„ í•¨ê»˜ ìƒì„±
export const CounterStoreContext = createContext<Store<CounterStore>>(
  createStore<CounterStore>({ count: 0, text: 'hello' }),
)

export const CounterStoreProvider = ({
  initialState,
  children,
}: PropsWithChildren<{
  initialState: CounterState
}>) => {
  const storeRef = useRef<Store<CounterStore>>()

  // ìŠ¤í† ì–´ë¥¼ ìƒì„±í•œ ì ì´ ì—†ë‹¤ë©´ ìµœì´ˆì— í•œ ë²ˆ ìƒì„±í•œë‹¤.
  if (!storeRef.current) {
    storeRef.current = createStore(initialState)
  }

  return (
    <CounterStoreContext.Provider value={storeRef.current}>
      {children}
    </CounterStoreContext.Provider>
  )
}
```

```js
export const useCounterContextSElector = <State extends unknown>(
  selector: (state: CounterStore) => State,
) => {
  const store = useContext(CounterStoreContext)

  // useSelectorSelectorë¥¼ ì‚¬ìš©í•´ë„ ë™ì¼
  const subscription = useSubscription(
    useMemo(
      () => ({
        getCurrentValue: () => selector(store.get()),
        subscribe: store.subscribe,
      }),
      [store, selector],
    ),
  )

  return [subscription, store.set] as const
}
```

## ğŸ“Œ 5.2.4 ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ Recoil, Jotai, Zustand ì‚´í´ë³´ê¸°

### í˜ì´ìŠ¤ë¶ì´ ë§Œë“  ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ Recoil

- í›…ì˜ ê°œë…ìœ¼ë¡œ ìƒíƒœ ê´€ë¦¬
- Atomì„ ì²˜ìŒ ë¦¬ì•¡íŠ¸ ìƒíƒœê³„ì—ì„œ ì„ ë³´ì´ê¸°ë„ í•¨
- ì•„ì§ ì •ì‹ ì¶œì‹œ ì•ˆí•¨(!) ì§€ê¸ˆë„ v0.7.7

```js
// atom: ìƒíƒœë¥¼ ë‚˜íƒ€ë‚´ëŠ” Recoilì˜ ìµœì†Œ ìƒíƒœ ë‹¨ìœ„
const counterState = atom({
  key: "counterState", // ë‹¤ë¥¸ atomê³¼ êµ¬ë³„í•˜ëŠ” ì‹ë³„ìê°€ ë˜ëŠ” í•„ìˆ˜ ê°’
  default: 0,
});

function Counter() {
  const [, setCount] = useRecoilState(counterState);

  function handleButtonClick() {
    setCount((count) => count + 1);
  }

  return (
    <>
      <button onCLick={handleButtonClick}>+</button>
    </>
  );
}

// atomì„ ê¸°ë°˜ìœ¼ë¡œ ë˜ ë‹¤ë¥¸ ìƒíƒœë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤.
const isBiggerThan10 = selector({
  key: "above10State",
  get: ({ get }) => {
    return get(counterSTate) >= 10;
  },
});

function Count() {
  const count = useRecoilValue(counterState);
  const biggerThan10 = useRecoilValue(isBiggerThan10);

  return (
    <>
      <h3>{count}</h3>
      <p>count is bigger than 10: {JSON.stringify(biggerThan10)}</p>
    </>
  );
}

export default function App() {
  return (
    <RecoilRoot>
      <Counter/>
      <Count/>
    </RecoilRoot>
  )
}
```
- ë¹„ë™ê¸° ì‘ì—…ì„ ì§€ì›í•˜ëŠ” API ì œê³µ

### Recoilì—ì„œ ì˜ê°ì„ ë°›ì€, ê·¸ëŸ¬ë‚˜ ì¡°ê¸ˆ ë” ìœ ì—°í•œ Jotai
```js
// **
const counterState = atom(0);

function Counter() {
  // **
  const [, setCount] = useAtom(counterState);

  function handleButtonClick() {
    setCount((count) => count + 1);
  }

  return (
    <>
      <button onCLick={handleButtonClick}>+</button>
    </>
  );
}

// **
const isBiggerThan10 = atom((get) => get(counterState) > 10)

function Count() {
  // **
  const count = useAtomValue(counterState);
  const biggerThan10 = useAtomValue(isBiggerThan10);

  return (
    <>
      <h3>{count}</h3>
      <p>count is bigger than 10: {JSON.stringify(biggerThan10)}</p>
    </>
  );
}

export default function App() {
  return (
    <>
      <Counter/>
      <Count/>
    </>
  )
}
```
- atom APIëŠ” ë¦¬ì•¡íŠ¸ì˜ useStateì™€ëŠ” ë‹¤ë¥´ê²Œ ì»´í¬ë„ŒíŠ¸ ì™¸ë¶€ì—ì„œë„ ì„ ì–¸í•  ìˆ˜ ìˆë‹¤.
- atomì€ ê°’ë¿ë§Œ ì•„ë‹ˆë¼ í•¨ìˆ˜ë¥¼ ì¸ìˆ˜ë¡œ ë°›ì„ ìˆ˜ ìˆëŠ”ë°, ì´ëŸ¬í•œ íŠ¹ì§•ì„ í™œìš©í•´ ë‹¤ë¥¸ atomì˜ ê°’ìœ¼ë¡œ ë¶€í„° íŒŒìƒëœ atomì„ ë§Œë“¤ ìˆ˜ ìˆë‹¤.
- key í•„ìš” X, selector ì—†ìŒ

### ì‘ê³  ë¹ ë¥´ë©° í™•ì¥ì—ë„ ìœ ì—°í•œ Zustand
- ê°„ë‹¨í•˜ë‹¤
- ë¼ì´ë¸ŒëŸ¬ë¦¬ í¬ë¦¬ê°€ ì‘ë‹¤
- íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±
- ë¦¬ë•ìŠ¤ì™€ ë§ˆì°¬ê°€ì§€ë¡œ ë¯¸ë“¤ì›¨ì–´ ì œê³µ
  - persist: ìŠ¤í† ì–´ ë°ì´í„° ì˜êµ¬ ë³´ì¡´
  - immer: ë³µì¡í•œ ê°ì²´ë¥¼ ê´€ë¦¬í•˜ê¸° ì‰½ê²Œ ë„ì™€ì¤Œ
  